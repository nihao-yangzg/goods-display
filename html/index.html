<html>
    <head>
        <meta charset="utf-8">
        <title>Display</title>
        <script src="../js/jquery-3.3.1.min.js"></script>
        <script src="../js/menu.js"></script>
        <script src="../js/select2.min.js"></script>
        <script src="../js/item.js"></script>
        <script src="../js/pager.js"></script>
        <script src="../js/index.js"></script>
        <link rel="stylesheet" href="../css/style.css" type="text/css">
        <link rel="stylesheet" href="../css/item.css" type="text/css">
        <link rel="stylesheet" href="../css/select2.css" type="text/css">
        <link rel="stylesheet" href="../css/page.css">
        <link rel="stylesheet" href="../css/index.css">
        <style>
            .page-foot {
                padding-left: 20%;
            }
            .main-foot{
                height: 60px;
                line-height: 60px;
                text-align: left;
                background-color: white;
                position:relative;
                /* top: 100%; */
                bottom:0;
                left: 0;
                width:100%;
            }
        </style>
    </head>
    <body>
        <div class="subnav container">
            SLOGEN / PICTURE
        </div>

        <div class="fix-container">
            <div class="content">
                <div class="content-search">
                    <div class="sub-search">
                        <h3>BRAND</h3>
                        <div>
                            <select class="brand-select" name="state" style="height:50%;">
                                <option value="AL">Alabama</option>
                                <option value="WY">Wyoming</option>
                                <option value="WY">Washington</option>
                                <option value="WY">Tokyo</option>
                                <option value="WY">Sydney</option>
                            </select>
                        </div>
                    </div>
                    <div class="sub-search">
                        <h3>PRODUCT</h3>
                        <div>
                            <select class="product-select" name="state">
                                <option value="AL">Shirt</option>
                                <option value="WY">Shoe</option>
                                <option value="WY">Hat</option>
                            </select>
                        </div>
                    </div>
                    
                </div>
                <div class="content-display">
                    <div class="goods">
                        <ul id="goods-list">
                        </ul>
                    </div>
                </div>
                <div class="page-foot">

                </div>

            </div>
            <hr/>
            <div class="main-foot">
                    <span>&copy Display System </span>
                </div>
        </div>
        
       
    </body>
    <script>
        $(function(){
            
            $('.brand-select').val("").select2({
                placeholder: "Select a brand",
                allowClear: true
            });
            $('.product-select').val("").select2({
                placeholder: "Select a type",
                allowClear: true
            })
            function getGoodsByPage(page) {
                if (page > 0) {
                    $.ajax({
                        url: '/api/goods?page=' + page,
                        type: 'get',
                        dateType: 'json',
                        success: function(res) {
                            console.log(res.data);
                            
                        },
                        error: function(err) {
                            console.log(err.responseText);
                        }

                    })
                }
            }
            
            var goodslist = [
                {'imgUrl': '../images/a.jpg', 'title': 'one more牛仔高腰显瘦宽松学生长裤', 'productId': 'fniewata', 'price': '$25.4', 'goodsUrl': 'http://www.baidu.com'},
                {'imgUrl': '../images/b.jpg', 'title': 'one more牛仔高腰显瘦宽松学生长裤', 'productId': 'fniewatb', 'price': '$25.4', 'goodsUrl': 'http://www.baidu.com'},
                {'imgUrl': '../images/c.jpg', 'title': 'one more牛仔高腰显瘦宽松学生长裤', 'productId': 'fniewatc', 'price': '$25.4', 'goodsUrl': 'http://www.baidu.com'},
                {'imgUrl': '../images/d.jpg', 'title': 'one more牛仔高腰显瘦宽松学生长裤', 'productId': 'fniewatd', 'price': '$25.4', 'goodsUrl': 'http://www.baidu.com'},
                {'imgUrl': '../images/e.jpg', 'title': 'one more牛仔高腰显瘦宽松学生长裤', 'productId': 'fniewate', 'price': '$25.4', 'goodsUrl': 'http://www.baidu.com'},
                {'imgUrl': '../images/f.jpg', 'title': 'one more牛仔高腰显瘦宽松学生长裤', 'productId': 'fniewatf', 'price': '$25.4', 'goodsUrl': 'http://www.baidu.com'},
                {'imgUrl': '../images/g.jpg', 'title': 'one more牛仔高腰显瘦宽松学生长裤', 'productId': 'fniewatg', 'price': '$25.4', 'goodsUrl': 'http://www.baidu.com'},
                {'imgUrl': '../images/h.jpg', 'title': 'one more牛仔高腰显瘦宽松学生长裤', 'productId': 'fniewath', 'price': '$25.4', 'goodsUrl': 'http://www.baidu.com'},
            ];
            var maxPageNo = 30;
            function goodsShow(goodslist) {
                $goodsList = $('#goods-list');
                $goodsList.empty();
                goodslist.forEach(function(goods, index) {
                    // var dom = createGoodsList0(goods);
                    var dom = createGoodsList1(goods);

                    if (index % 3 === 0) {
                        dom.setAttribute('class', 'first');
                    } else if (index % 3 === 2) {
                        dom.setAttribute('class', 'last');
                    }
                    $goodsList.append(dom);
                });
            }
            goodsShow(goodslist);
            // $('.goods ul').on('mouseover', function(event) {
            //     console.log(event.target.nodeName);
            //     if (event.target.nodeName === 'IMG') {
            //         var $img = $(this);
            //         var height = $img.height(),
            //             width = $img.width();
            //         var hover = document.createElement('div');
            //         hover.style.height = height;
            //         hover.style.width = width;
            //         hover.setAttribute('id', 'img-hover');
            //         hover.style.position = 'relative';
            //         hover.style.top = '0';
            //         hover.style.left = '0';
            //         hover.style.backgroundColor = '#ccc';
            //         hover.textContent = 'click';
            //         console.log(hover);
            //         $img.parent('div').append(hover);
            //     }
            // }).on('mouseout', function() {
            //     $('#img-hover').remove();
            // })
            $('.goods ul').on('click', function(event) {
                if (event.target.nodeName === 'IMG') {
                    var id = $(event.target).attr('productId');
                    console.log(id);
                    window.open('./detail.html?id=' + id);
                }
            });
            var $pager = $('div.page-foot');
            $pager.append($(initPager(undefined, 'goods-pager')));
            $pager.on('click', function(e) {
               
                var target = e.target;
                var $this = $(target);
                var page, action, targetPage;
                if (target.nodeName === 'A') {
                    console.log($this);
                    page = getPageData($this);
                    console.log('page  ', page);
                    if (!page) {
                        page = getCurrentPage();
                        action = getPageAction($this);
                        console.log('action', action);
                        console.log('page', page);
                        if (isNext(action)) {
                            targetPage = +(page) + 1;
                        } else {
                            targetPage = +(page) - 1;
                        }
                    } else {
                        targetPage = +page;
                    }
                    _pageActive($this);
                    console.log(targetPage);
                    // getGoodsByPage(targetPage);
                    
                    if (targetPage !== 1) {
                        setPreventButton(true);
                    } else {
                        setPreventButton(false);
                    }

                    if (targetPage !== maxPageNo) {
                        setNextButton(true);
                    } else {
                        setNextButton(false);
                    }
                }
            })
            function setPreventButton(show) {
                var $a = $('#goods-pager>ul').children('li:nth-child(1)').children('a');
                if (show) {
                    $a.removeClass('hidden');
                } else {
                    $a.addClass('hidden');
                }
            }
            function setNextButton(show) {
                var $a = $('#goods-pager>ul').children('li:last-child').children('a');
                if (show) {
                    $a.removeClass('hidden');
                } else {
                    $a.addClass('hidden');
                }
            }
            
            function _pageActive($this) {
                
                var value;
                if (getPageData($this)) {
                    value = +($this.attr('page-data'));
                    // index = $this.parents('li').index() - 1;
                } else {
                    var action = getPageAction($this);
                    var currentPage = getCurrentPage();
                    var index = getCurrentPageIndex();
                    
                    console.log('index:  ', index);
                    if (isNext(action)) {
                        value = currentPage + 1;
                        $this = $this.parents('#goods-pager>ul').find('li:nth-child(' + (index + 1 > 11 ? 11 : (index + 1)) + ')').children('a');
                    } else {
                        value = currentPage - 1;
                        $this = $this.parents('#goods-pager>ul').find('li:nth-child(' + (index - 1 > 2 ? (index - 1) : 2) + ')').children('a');
                    }
                    console.log('value', value);
                    console.log($this[0]);
                }
                $this.parents('div.pager>ul').find('a.active').removeClass('active');
                // var $adoms = $this.parents('#goods-pager').find('a.page-link');
                if (value > 5 && value < maxPageNo) {
                    setNextButton(true);
                    var sequenceStart, sequenceEnd;
                    sequenceStart = value - 5 > 0 ? (value - 5) : 1;
                    sequenceEnd = value + 4 < maxPageNo ? (value + 4) : maxPageNo;
                    if (sequenceEnd === maxPageNo) {
                        sequenceStart = maxPageNo - 10 + 1;
                        $this.addClass('active');
                    } else {
                        $this.parents('#goods-pager>ul').children('li:nth-child(7)').children('a.page-link').addClass('active');
                    }
                    _sequenceUpdate([sequenceStart, sequenceEnd]);
                } else if (value <= 5 || value > maxPageNo - 4) {
                    $this.addClass('active');                   
                }
            }
            function _sequenceUpdate(sequence) {
                var start = sequence[0] > 0 ? sequence[0] : 1,
                    end = sequence[1] > 10 ? sequence[1] : 10;
                var size = end - start + 1;
                var currentValue;
                $('#goods-pager').find('a.page-link').each(function(index, dom) {
                    if (index === 0 || index > size) {
                        return true;
                    } else {
                        currentValue = start + index - 1;
                        $(dom).attr('page-data', currentValue).text(currentValue);
                    }
                })
            }
            function getPageAction($this) {
                return $this.attr('page-action');
            }
            function getPageData($this) {
                return $this.attr('page-data');
            }
            function isNext(value) {
                return value === '+1';
            }
            function isPrevent(value) {
                return value === '-1';
            }
            function isPage(value) {
                var numReg = /\d+/;
                return numReg.test(value);
            }
            function getCurrentPage() {
                var $currentPage = $('a.page-link.active');
                return +($currentPage.attr('page-data'));
            }
            function getCurrentPageIndex() {
                return $('a.page-link.active').parent('li').index() + 1;
            }
        })
    </script>
</html>