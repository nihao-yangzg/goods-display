<html>
    <head>
        <meta charset='utf-8'>
        <title>Goods Manage</title>
        <script src="../js/jquery-3.3.1.min.js"></script>
        <script src="../js/manage-menu.js"></script>
        <script src="../js/select2.min.js"></script>
        <script src="../js/item.js"></script>
        <link rel="stylesheet" href="../css/font-awesome.min.css" type="text/css">
        <link rel="stylesheet" href="../css/item.css" type="text/css">
        <link rel="stylesheet" href="../css/select2.css" type="text/css">
        <link rel="stylesheet" href="../css/manage1.css" type="text/css">
        <link rel="stylesheet" href="../css/manage2.css" type="text/css">
        <link rel="stylesheet" href="../css/modal.css">
        <link rel="stylesheet" href="../css/manage-menu.css">
    </head>
    <body>
        <!-- <div class="subnav container">
            SLOGEN / PICTURE
        </div> -->

        <div class="fix-container">
            <div class="content">
                <div class="content-display manage">
                    <div class="add-goods"  title="添加商品" id="add-goods">
                        <span class="fa fa-plus fa-2x"></span>
                    </div>
                    <div class="goods">
                        <ul id="goods-list">
                        </ul>
                    </div>
                </div>
            </div>
        </div>
        <div class="display-modal hidden" id="modal">
            <div class="dmodal-content">
                <div class="dmodal-header">
                    <h2>Delete Product</h2>
                </div>
                <div class="dmodal-body">
                    <div class="message">
                        <span>确定要删除此商品吗？</span>
                        <span style="visibility: hidden;" id="productId"></span>
                    </div>
                </div>
                <div class="dmodal-footer">
                    <div class="action">
                        <button class='cancel'>取消</button>
                        <button class='ok'>确定</button>
                    </div>
                </div>
            </div>
        </div>
        
    </body>
    <script>
        $(function(){
            
            var goodslist = [
                {'imgUrl': '../images/a.jpg', 'title': 'one more牛仔高腰显瘦宽松学生长裤', 'productId': 'fniewata', 'price': '$25.4', 'goodsUrl': 'http://www.baidu.com'},
                {'imgUrl': '../images/b.jpg', 'title': 'one more牛仔高腰显瘦宽松学生长裤', 'productId': 'fniewatb', 'price': '$25.4', 'goodsUrl': 'http://www.baidu.com'},
                {'imgUrl': '../images/c.jpg', 'title': 'one more牛仔高腰显瘦宽松学生长裤', 'productId': 'fniewatc', 'price': '$25.4', 'goodsUrl': 'http://www.baidu.com'},
                {'imgUrl': '../images/d.jpg', 'title': 'one more牛仔高腰显瘦宽松学生长裤', 'productId': 'fniewatd', 'price': '$25.4', 'goodsUrl': 'http://www.baidu.com'},
                {'imgUrl': '../images/e.jpg', 'title': 'one more牛仔高腰显瘦宽松学生长裤', 'productId': 'fniewate', 'price': '$25.4', 'goodsUrl': 'http://www.baidu.com'},
                {'imgUrl': '../images/f.jpg', 'title': 'one more牛仔高腰显瘦宽松学生长裤', 'productId': 'fniewatf', 'price': '$25.4', 'goodsUrl': 'http://www.baidu.com'},
                {'imgUrl': '../images/g.jpg', 'title': 'one more牛仔高腰显瘦宽松学生长裤', 'productId': 'fniewatg', 'price': '$25.4', 'goodsUrl': 'http://www.baidu.com'},
                {'imgUrl': '../images/h.jpg', 'title': 'one more牛仔高腰显瘦宽松学生长裤', 'productId': 'fniewath', 'price': '$25.4', 'goodsUrl': 'http://www.baidu.com'},
            ];
            function createGoodsList(goods){
                var dom = document.createElement("li");
                var container = document.createElement('div');
                var subContainer = document.createElement('div');
                var imgDiv = document.createElement('div');
                var img = document.createElement('img');
                var price = document.createElement('em');

                img.setAttribute('src', goods['imgUrl']);
                img.setAttribute('productId', goods['productId']);
                imgDiv.appendChild(img);
                imgDiv.setAttribute('class', 'img');

                var title = document.createElement('p');
                var link = document.createElement('a');
                link.setAttribute('href', goods['goodsUrl']);
                link.textContent = goods['title'];
                title.appendChild(link);

                price.textContent = goods['price'];
                price.setAttribute('class', 'price');
                // title.textContent = goods['title'];

                subContainer.setAttribute('class', 'goods-subcontainer');
                subContainer.append(imgDiv);
                subContainer.append(price);
                subContainer.appendChild(title);

                container.setAttribute('class','goods-container');                
                container.appendChild(subContainer);
                dom.setAttribute('data-id', goods['productId']);
                dom.appendChild(container);

                return dom;
            }
            function _display(goodslist) {
                goodslist.forEach(function(goods, index) {
                    $goodsList = $('#goods-list')
                    var dom = createGoodsList(goods);
                    if (index % 3 === 0) {
                        dom.setAttribute('class', 'first');
                    } else if (index % 3 === 2) {
                        dom.setAttribute('class', 'last');
                    }
                    $goodsList.append(dom);
                });
            }
            _display(goodslist);
            $('.goods-container').on('mouseenter', function(event) {
                console.log(event.target);
                // if (event.target.nodeName === 'IMG') {
                var $this = $(this);
                var height = $this.height(),
                    width = $this.width();
                var hover = document.createElement('div');
                hover.style.height = height;
                hover.style.width = width;
                hover.setAttribute('id', 'img-hover');
                hover.setAttribute('class', 'imghover');
                
                var containerDom = document.createElement('div');
                containerDom.setAttribute('class', '')

                var deleteDom = document.createElement('span'),
                    editDom = document.createElement('span');

                deleteDom.setAttribute('class', 'fa fa-trash fa-2x delete');
                $(deleteDom).on('click', function() {
                    _showModal();
                    var productId = $this.parents('li').attr('data-id');
                    $('#productId').attr('productId', productId);
                    
                })

                editDom.setAttribute('class', 'fa fa-pencil-square-o fa-2x edit');
                $(editDom).on('click', function(e) {
                    var productId = $this.parents('li').attr('data-id');
                    if (productId) {
                        window.open('/html/submit.html?productId=' + productId);
                    }
                })

                containerDom.appendChild(editDom);
                containerDom.appendChild(deleteDom);

                hover.appendChild(containerDom);
                // hover.textContent = 'click';
                
                $this.append(hover);
                // }
            }).on('mouseleave', function() {
                $('#img-hover').remove();
            })
            $('.goods ul').on('click', function(event) {
                if (event.target.nodeName === 'IMG') {
                    var id = $(event.target).attr('productId');
                    console.log(id);
                    location.href='./detail.html?id=' + id;
                }
            });

            $('#add-goods').on('click', function(e) {
                window.open("/html/submit.html");
            })

            $('#modal button.ok').on('click', function(){
                var productId = $('#productId').attr('productId');
                deleteProduct(productId);
            })
            $('#modal button.cancel').on('click', function(){
                $('#productId').removeAttr('productId');
                _hideModal();
            })
            function _showModal() {
                var $modal = $('#modal');
                $modal.removeClass('hidden');
            }
            function _hideModal() {
                var $modal = $('#modal');
                $modal.addClass('hidden');
            }
            function deleteProduct(productId) {
                if (productId !== undefined) {
                    $.ajax({
                        url: '/api/product/delete',
                        data: {'id': productId},
                        dataType: 'json',
                        type: 'delete',
                        success: function(res) {
                            _display(res.data);
                        }, error: function(err) {

                        }
                    })
                }
            }
        })
    </script>
</html>